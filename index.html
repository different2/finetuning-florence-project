<!-- Version 6.0 (Florence-2 Training Format) -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Annotation Tool - Florence-2 Format</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>Image Annotation Tool - Florence-2 Training Format</h1>

    <!-- Classic Dropdown Menu Bar -->
    <div class="menu-bar">
        <!-- File Menu -->
        <div class="dropdown">
            <button class="dropbtn">File</button>
            <div class="dropdown-content">
                <a href="#" id="loadSingleImage">Load Single Image</a>
                <a href="#" id="loadFolder">Load Image Folder</a>
                <a href="#" id="setSaveDirectory">Set Save Directory</a>
                <hr>
                <a href="#" id="saveAnnotations">Save Annotations & Image</a>
            </div>
        </div>

        <!-- Tools Menu -->
        <div class="dropdown">
            <button class="dropbtn">Tools</button>
            <div class="dropdown-content">
                <a href="#" id="detectObjects">Detect Objects</a>
                <a href="#" id="importJson">Import Annotation JSON</a>
                <hr>
                <div class="menu-item-static">
                    <span>Box Color:</span>
                    <input type="color" id="colorPicker" value="#FF0000">
                </div>
            </div>
        </div>

        <!-- Session Menu -->
        <div class="dropdown">
            <button class="dropbtn">Session</button>
            <div class="dropdown-content">
                <a href="#" id="clearAllCache">Clear All Cached Data</a>
            </div>
        </div>

        <div id="dirStatus" class="status-box">No directory selected.</div>
    </div>

    <!-- Hidden file inputs -->
    <input type="file" id="imageLoader" accept="image/*" hidden>
    <input type="file" id="jsonLoader" accept=".json" hidden>

    <div class="main-container">
        <!-- Image Viewer -->
        <div class="image-viewer">
            <div class="canvas-container">
                <canvas id="canvas"></canvas>
            </div>
            <div class="image-nav-buttons">
                <button id="prevImage">&lt; Prev</button>
                <span id="image-counter">No image loaded</span>
                <button id="nextImage">Next &gt;</button>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="sidebar">
            <!-- Scene Controls -->
            <div class="scene-controls">
                <h4>Phrase Grounding (Florence-2 Main Task)</h4>
                
                <label for="userNotes">User Notes / Instructions (Persistent):</label>
                <textarea id="userNotes" rows="3" placeholder="Write instructions for caption generation. E.g., 'Emphasize color harmony', 'Focus on frame-subject relationship', 'Mention how gold elements match'. These notes guide the Refresh Analysis."></textarea>
                
                <label for="phraseGrounding">Generated Phrase Grounding (&lt;CAPTION_TO_PHRASE_GROUNDING&gt;) - Read Only:</label>
                <textarea id="phraseGrounding" rows="8" readonly placeholder="Auto-generated by Refresh Analysis based on your bbox labels and descriptions. This is what your Discord bot will use after fine-tuning!"></textarea>
                
                <button id="refreshAnalysis" style="width: 100%; margin: 10px 0; padding: 12px; background-color: #0066cc; color: white; font-weight: bold;">
                    ðŸ”„ Refresh Phrase Grounding from Current Annotations
                </button>
                
                <label for="styleInput">Art Style (Metadata):</label>
                <input type="text" id="styleInput" placeholder="e.g., anime, realistic, watercolor">
                
                <label for="sourceInput">Source/Series (Metadata):</label>
                <input type="text" id="sourceInput" placeholder="e.g., Fate/Grand Order">
                
                <label for="artistInput">Artist (Metadata):</label>
                <input type="text" id="artistInput" placeholder="e.g., official art">
            </div>

            <!-- Annotation Controls -->
            <div class="edit-controls">
                <h4>Annotation Details (&lt;DENSE_REGION_CAPTION&gt;)</h4>
                <div id="captions"></div>
                <label for="labelInput">Label (Short):</label>
                <input type="text" id="labelInput" placeholder="e.g., woman, frame, spear">
                
                <label for="objectDescription">Description (Detailed):</label>
                <textarea id="objectDescription" rows="3" placeholder="Rich description for dense region caption task"></textarea>
                
                <label for="objectAttributes">Attributes (comma-separated):</label>
                <input type="text" id="objectAttributes" placeholder="e.g., purple, gold, ornate">
                
                <button id="updateAnnotationButton">Update Annotation</button>
                <button id="deleteButton">Delete Annotation</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>